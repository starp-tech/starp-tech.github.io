<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>starpy app - collaborative media sharing video player online offline private</title>
  <link rel="icon" href="favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="starpy app - collaborative media sharing video player online, offline and private">
	<meta name=”robots” content="index, follow">
  <script 
  	src="https://cdn.jsdelivr.net/npm/webtorrent@latest/webtorrent.min.js">
  </script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha512-2cbsQGdowNDPcKuoBd2bCcsJky87Mv0LEtD/nunJUgk6MOYTgVMGihS/xCEghNf04DPhNiJ4DZw5BxDd1uyOdw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <link rel="stylesheet" href="minimal-pace.css">

  <style type="text/css">
/*
		@font-face {
		  font-family: Didot; 
		  src: url("https://www.starpy.me/fonts/Didot.ttc"); 
		}*/
		@font-face {
		  font-family: CODE_Bold; 
		  src: url("./fonts/CODE_Bold.otf"); 
		}
		body, html {
	    scroll-behavior: smooth;
		  background-color: #000;
		  color: #fff;
		  width: 100%;
		  height: 100%;
		  margin: 0;
		  padding: 0;
/*		  overflow: hidden;*/
		}
		#bgCanvas {
			position:absolute;
			top:0;
			left:0
		}
		#terCanvas {
			position: absolute;
	    height: 100px;
	    width: 100%;
	    bottom: 0;
		}
		.jumbotron {
			background: transparent;
		}
		.jumbotron h1, p, a, #partyTitle, #videoTitle {
			color:palegoldenrod;
			font-family: CODE_Bold, Helvetica, Arial, sans-serif;
		}
		.jumbotron p, #videoTitle {
			font-size: 28px;
/*		  text-shadow: 2px 2px black;*/
			-webkit-font-smoothing:antialiased;
		}
		.jumbotron h1, #partyTitle {
			font-size: 88px;
/*		  text-shadow: 2px 2px black;*/
			-webkit-font-smoothing:antialiased;
		}
		.parent-vertical {
		  display: flex;
		  flex-direction: column;
		  justify-content: center;
		}
		.heading-info {
			position: absolute;
			width:100%;
			height:100%;
			text-align: center;
		}
		#joinButton, .joinButton {
	 		text-decoration: none;
	 		background-color: palegoldenrod;
	 		display: inline-block;
	 		color:black;
	 		padding: 20px;
	 		margin-top:20px;
	 		font-size: 20px;
	 		border-radius: 15px;
	 		cursor: pointer;
		}
		.hidden {
			display: none !important;
		}
		.pageContainer {
			position: relative;
			width: 100%;
			height: 100%;
			background-size: cover;
			background-position: center;
	    -webkit-filter: contrast(1px);
		  -moz-filter: contrast(1px);
		  -o-filter: contrast(1px);
		  -ms-filter: contrast(1px);
		  filter: contrast(1px);   
		}
		#videoContainer {
			position: fixed;
	    width: 100%;
	    height: 100%;
	    left: 0%;
	    right: 0;
	    top: 0%;
	    bottom: 0;
	    margin: 0;
	    background-color: rgba(0, 0, 0, .8);
	    z-index: 1000;
		}
		#videoPlayer {
	    width: 90%;
	    height: 90%;
	    left: 5%;
	    right: 0;
	    top: 5%;
	    bottom: 0;
	    margin: 0;
			position: fixed;
	    z-index: 1000;
			border-radius: 10px;
		}
		.jumbotron p.big-message {
/*			color:black;*/
			font-size: 48px;
/*		  text-shadow: 2px 2px black;*/
		  font-weight: 600;
		}
		.background-overlay {
			position: absolute;
			width: 100%;
			height: 100%;
			background-color: rgba(0,0,0,0.3);
		}
		.chevron::before {
		  border-style: solid;
		  border-width: 2px 2px 0 0;
		  content: '';
		  display: inline-block;
		  height: 0.45em;
		  left: 0.15em;
		  position: relative;
		  top: 0.15em;
		  transform: rotate(-45deg);
		  vertical-align: top;
		  border-color: palegoldenrod;
		  width: 0.45em;
		}

		.chevron.right:before {
		  left: 0;
		  transform: rotate(45deg);
		}

		.chevron.bottom:before {
		  top: 0;
		  transform: rotate(135deg);
		}

		.chevron.left:before {
		  left: 0.25em;
		  transform: rotate(-135deg);
		}

		.sys-intro-arrow {
	    position: absolute;
	    bottom: 20px;
	    width: 100%;
	    text-align: center;
	    font-size: 32px;
	    cursor: pointer;
	    display: block;
	    z-index: 100;
		}

		.close {
		  position: fixed;
		  right: 0;
		  top: 20px;
		  width: 60px;
		  height: 60px;
		  opacity: 0.7;
		  cursor: pointer;
		  z-index: 2000;
		}

		.close:hover {
		  opacity: 1;
		}

		.close:before, .close:after {
		  position: absolute;
		  left: 15px;
		  content: ' ';
		  height: 60px;
		  width: 2px;
		  background-color: palegoldenrod;
		}
		.close:before {
		  transform: rotate(45deg);
		}
		.close:after {
		  transform: rotate(-45deg);
		}
		.playPrevParty {
			position: fixed;
	    top: calc(50% - 30px);
	    left: 20px;
	    font-size: 60px;
	    cursor: pointer;
		  z-index: 2000;
		}

		.playPrevParty:before {
			left:0 !important;
		}
		.playNextParty {
			position: fixed;
	    top: calc(50% - 30px);
	    right: 20px;
	    font-size: 60px;
	    cursor: pointer;
		  z-index: 2000;
		}

		.overflowHidden {
			overflow: hidden;
		}
		#partyTitle {
			font-size: 44px;
			margin:5px;
	    position: absolute;
	    z-index: 1001;
		}
		#videoTitle {
			margin: 5px;
	    position: absolute;
	    z-index: 1001;
	    top:50px;
		}
		@media (max-width: 800px) {
			.playNextParty {
		    right: 10px;
/*		    top: calc(85% - 30px);*/
		  }
			.playPrevParty {
		    left: 10px;
/*		    top: calc(85% - 30px);*/
		  }
			.jumbotron p.big-message {
				font-size: 30px;
				padding: 20px;
			}
			.jumbotron h1 {
				font-size: 52px;
				padding: 20px;
			}
			#videoPlayer {
				width: 100%;
		    height: 100%;
		    left: 0;
		    right: 0;
		    top: 0;
		    bottom: 0;
		    margin: 0;
		    position: fixed;
		    border-radius: 10px;
		  }
			#videoTitle {
		    top:100px;
			}
		}

  </style>
</head>
<body>
	<canvas id="bgCanvas"></canvas>
	<canvas id="terCanvas"></canvas>
	<div class="pageContainer">
		<div class="background-overlay" style="
			background-color: rgba(0,0,0,0.1);
		"></div>
		<div class="container parent-vertical heading-info">
			<div class="jumbotron">
			  	<div class="container">
				  	<h1>Starpy</h1>
				  	<p class="big-message">Same stars experience.</p>
				  	<a class="hidden" id="joinButton" href="#">
				  		Join  
				  	</a>
				  	</div>
			  	</div>
			</div>
		</div>

    <div class="sys-intro-arrow">
    	<a class="chevron bottom" href="#platform">
	    </a>
    </div>
	</div>

	<div class="pageContainer" 
		id="platform" 
		style="background-image: url(img/fr.jpeg);"
	>
    <div class="sys-intro-arrow">
    	<a class="chevron bottom" href="#privacy">
	    </a>
    </div>
		<div class="background-overlay" style="
			background-color: rgba(0,0,0,0.5);
		"></div>
		<div class="container parent-vertical heading-info">
			<div class="jumbotron">
			  	<div class="container">
				  	<h1>
				  		Connect, Chat <br> & Share 4K Media
				  	</h1>
				  	<p class="big-message">
				  		in a realtime party <br> with a magic link
					  </p>
				  	<a id="joinParty" class="joinButton" target="blank">
				  		JOIN RANDOM PARTY
				  	</a>
				  	</div>
			  	</div>
			</div>
		</div>
	</div>

	<div class="pageContainer" 
		id="privacy" 
		style="
			background-image: url(img/privacy1.jpeg);
			background-position: right;
		"
	>
    <div class="sys-intro-arrow">
    	<a class="chevron bottom" href="#hacking">
	    </a>
    </div>
		<div class="background-overlay" style="
			background-color: rgba(0,0,0,0.4);
		"></div>
		<div class="container parent-vertical heading-info">
			<div class="jumbotron">
			  	<div class="container">
				  	<h1 style="color:palegoldenrod;">Ultimate <br> Privacy</h1>
				  	<p class="big-message" style="color:palegoldenrod;">
				  	no registration required<br> transparent p2p encryption
				  	</p>
				  	<a class="joinButton" target="blank" href="https://github.com/margelo/react-native-quick-crypto">
				  		Learn More About Encryption
				  	</a>
				  	</div>
			  	</div>
			</div>
		</div>
	</div>

	<div class="pageContainer"
		id="hacking" 
		style="
			background-image: url(img/cloud1.jpeg);
			background-position: right;
		"
	>
    <div class="sys-intro-arrow">
    	<a class="chevron bottom" href="#connect">
	    </a>
    </div>
		<div class="background-overlay" style="
			background-color: rgba(0,0,0,0.5);
		"></div>
		<div class="container parent-vertical heading-info">
			<div class="jumbotron">
			  	<div class="container">
				  	<h1>Store Your Media</h1>
				  	<p class="big-message">locally, <br> use peer cloud <br> or use starpy cloud</p>
				  	<a class="joinButton" target="blank" href="https://github.com/starp-tech">
				  		Pricing 
				  	</a>
				  	<a class="joinButton" target="blank" href="https://github.com/starp-tech">
				  		Start Hacking  
				  	</a>
				  	</div>
			  	</div>
			</div>
		</div>
	</div>

	<div class="pageContainer" 
		id="connect"
		style="background-image: url(img/offline1.jpeg);"
	>
		<div class="background-overlay" style="
			background-color: rgba(0,0,0,0.5);
		"></div>
		<div class="container parent-vertical heading-info">
			<div class="jumbotron">
			  	<div class="container">
				  	<h1>
				  		Offline First
				  	</h1>
				  	<p class="big-message"> Chat
& Share Media <br> with users nearby <br> even when offline</p>
				  	<a class="joinButton" href="https://www.starpy.me/appcast/StarpyApp.tar.xz">Download For Mac OS X</a>
				  	</div>
			  	</div>
			</div>
		</div>
	</div>
	<div 
		class="hidden"
		id="videoContainer"
	>
		<h1 id="partyTitle"></h1>
		<h2 id="videoTitle"></h2>
		<a href="#videoPlayer" class="close" onclick="hideVideoPlayer()"></a>
  	<a class="chevron left playPrevParty" id="playPrevParty" href="#videoPlayer">
    </a>
  	<a class="chevron right playNextParty" id="playNextParty"  href="#videoPlayer">
    </a>
		<video id="videoPlayer" src="" autoplay></video>
	</div>
	<script type="text/javascript">
  	(function() {
	    	var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || 
									  window.webkitRequestAnimationFrame || window.msRequestAnimationFrame || function( callback ){
	                window.setTimeout(callback, 1000 / 60);
	              };
		  	window.requestAnimationFrame = requestAnimationFrame;
		})();
		let disableAnimation = false;
		const drawLandscape = (cb) => {
			// Terrain stuff.
			let terrain = document.getElementById("terCanvas"),
				background = document.getElementById("bgCanvas"),
				terCtx = terrain.getContext("2d"),
				bgCtx = background.getContext("2d"),
				width = window.innerWidth,
				height = document.body.offsetHeight;
		    (height < 400)?height = 400:height;

			terrain.width = background.width = width;
			terrain.height = background.height = height;

			// Some random points
			var points = [],
				displacement = 140,
				power = Math.pow(2,Math.ceil(Math.log(width)/(Math.log(2))));
			
			// set the start height and end height for the terrain
			points[0] = (height - (Math.random()*height/2))-displacement;
			points[power] = (height - (Math.random()*height/2))-displacement;

			// create the rest of the points
			for(var i = 1; i<power; i*=2){
				for(var j = (power/i)/2; j <power; j+=power/i){
					points[j] = ((points[j - (power/i)/2] + points[j + (power/i)/2]) / 2) + Math.floor(Math.random()*-displacement+displacement );
				}
				displacement *= 0.6;
			}

			// draw the terrain
			terCtx.beginPath();
							
			for(var i = 0; i<=width; i++){
				if(i === 0){
					terCtx.moveTo(0, points[0]);
				}else if(points[i] !== undefined){
					terCtx.lineTo(i, points[i]);
				}
			}

			terCtx.lineTo(width,terrain.height);
			terCtx.lineTo(0,terrain.height);
			terCtx.lineTo(0,points[0]);
			terCtx.fill();


			// Second canvas used for the stars
			bgCtx.fillStyle = '#05004c';
			bgCtx.fillRect(0,0,width,height);

			// stars
			function Star(options){
				this.size = Math.random()*2;
				this.speed = Math.random()*.1;
				this.x = options.x;
				this.y = options.y;
			}

			Star.prototype.reset = function(){
				this.size = Math.random()*2;
				this.speed = Math.random()*.1;
				this.x = width;
				this.y = Math.random()*height;
			}
			
			Star.prototype.update = function(){
				this.x-=this.speed;
				if(this.x<0){
				  this.reset();
				}else{
				  bgCtx.fillRect(this.x,this.y,this.size,this.size); 
				}
			}
			
			function ShootingStar(){
				this.reset();
			}
			
			ShootingStar.prototype.reset = function(){
				this.x = Math.random()*width;
				this.y = 0;
				this.len = (Math.random()*80)+10;
				this.speed = (Math.random()*10)+6;
				this.size = (Math.random()*1)+0.1;
		    // this is used so the shooting stars arent constant
				this.waitTime =  new Date().getTime() + (Math.random()*3000)+500;
				this.active = false;
			}
			
			ShootingStar.prototype.update = function(){
				if(this.active){
					this.x-=this.speed;
					this.y+=this.speed;
					if(this.x<0 || this.y >= height){
					  this.reset();
					}else{
					bgCtx.lineWidth = this.size;
						bgCtx.beginPath();
						bgCtx.moveTo(this.x,this.y);
						bgCtx.lineTo(this.x+this.len, this.y-this.len);
						bgCtx.stroke();
					}
				}else{
					if(this.waitTime < new Date().getTime()){
						this.active = true;
					}			
				}
			}

			var entities = [];
			
			// init the stars
			for(var i=0; i < height; i++){
				entities.push(new Star({x:Math.random()*width, y:Math.random()*height}));
			}
		  
			// Add 2 shooting stars that just cycle.
			entities.push(new ShootingStar());
			entities.push(new ShootingStar());
			
			//animate background
			function animate(){
				if(disableAnimation === true) 
					return
				bgCtx.fillStyle = '#05004c';
				bgCtx.fillRect(0,0,width,height);
				bgCtx.fillStyle = '#ffffff';
				bgCtx.strokeStyle = '#ffffff';

				var entLen = entities.length;
			  
				while(entLen--){
					entities[entLen].update();
				}
				
				requestAnimationFrame(animate);
			}
			disableAnimation = false;
			animate()
		}

		drawLandscape()
		let isResizeLocked = false
		let resizeTimeout;
		document.getElementById("platform").style = "background-image: url(img/fr.jpeg);background-position:"+window.innerWidth/2+"px;"
		addEventListener("resize", (event) => {
			// console.info('resize')
			disableAnimation = true;
			isResizeLocked = true;
			document.getElementById("platform").style = "background-image: url(img/fr.jpeg);background-position:"+window.innerWidth/2+"px;"
			clearTimeout(resizeTimeout)
			resizeTimeout = null
			resizeTimeout = setTimeout(()=>{
				drawLandscape()
				isResizeLocked = false;
			}, 100)
		})
		let isPlaying = false
		const playMediaLink = async (mediaLink, currentPosition) => {
			if(isPlaying)
				return

			isPlaying = true;
			
			try {
				
				if(mediaLink.search("magnet") > -1) {
					await playMesh(mediaLink, currentPosition)
				} else {
					showVideoPlayer(mediaLink, currentPosition)
				}

			} catch(err) {
				isPlaying = false
				console.error("playMediaLink err", err)
			}
		}

		const playMesh = async (mediaLink, currentPosition) => 
			new Promise((resolve,reject)=> {
				console.info("playMediaLink", mediaLink)
				const client = new WebTorrent({
					// downloadLimit:1000
				})
		    client.on('error', function (err) {
		      console.error('playMediaLink err: ' + err.message)
		      reject(err)
		    })
				const download = () =>  {
					console.info('playMediaLink on download')
					client.add(mediaLink, (media) => {
						try {
							console.info('playMediaLink on media', media)
						  const file = media.files.find(function (file) {
			          return file.name.endsWith(".mp4");
			        });
						  console.info('playMediaLink on file', file)
			        file.getStreamURL((err, url) => {
			          console.log("playMediaLink ready", url);
			          showVideoPlayer(url, currentPosition)
			          resolve(url)
			        });
						} catch(err) {
							console.error("playMediaLink err", err)
						}
					})
				}
				navigator.serviceWorker.register("sw.min.js")
				.then(reg => {
				  const worker = reg.active || reg.waiting || reg.installing
				  function checkState (worker) {
				    return worker.state === 'activated' && client.loadWorker(worker, download)
				  }
				  if (!checkState(worker)) {
				    worker.addEventListener('statechange', ({ target }) => checkState(target))
				  }
				})
			})

		const videoContainer = document.getElementById("videoContainer")
		const videoPlayer = document.getElementById("videoPlayer")
		let currentPosition;
		
		const showVideoPlayer = (mediaLink, cp) => {
			currentPosition = cp
			videoPlayer.src = mediaLink
			videoContainer.className = ""
			document.body.className = document.body.className + " overflowHidden"
		}

		videoPlayer.addEventListener('loadedmetadata', (meta) => {
			console.info(meta)
			if(currentPosition) {
				const percent = 
					videoPlayer.duration * currentPosition
			  videoPlayer.currentTime = percent
			}
		}, false);
		const hideVideoPlayer = (e) => {
			if(videoContainer.className === "hidden")
				return
			document.body.className = ""
			if(e)
				e.preventDefault()
			videoPlayer.src = ""
			videoContainer.className = "hidden"
			isPlaying = false;
		}
	</script>
	<script type="text/javascript" src="js/contact.js">
	</script>
<!-- 	<script type="text/javascript" src="js/media.js">
	</script> -->
	<script type="text/javascript" src="js/socket.js">
	</script>
</body>
</html>